{% extends "base.html" %}

{% block content %}
<div class="header">
    <div class="welcome-text">
        <h2>Hello, {{ user.name }}</h2>
        <p>Focus on the process.</p>
    </div>
    <div class="level-badge">
        ‚≠ê Level {{ user.level }}: {{ user.title if user.title else 'Novice' }}
    </div>
</div>

<div class="stats-row">
    <div class="stat-card xp-card">
        <div class="xp-value">‚ö° {{ user.total_xp }}</div>
        <div class="xp-label">Total XP Earned</div>
    </div>

    <div class="stat-card">
        {% if user.is_connected %}
            <div style="display: flex; flex-direction: column; align-items: center; justify-content: center;">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                    {% if user.profile_pic %}
                        <img src="{{ user.profile_pic }}" style="width: 32px; height: 32px; border-radius: 50%; border: 2px solid #4ade80;">
                    {% else %}
                         <span style="font-size: 1.5rem;">üë§</span>
                    {% endif %}
                    <span style="color: #4ade80; font-weight: bold; font-size: 1.2rem;">{{ user.steps }}</span>
                </div>
                
                <div style="font-size: 0.8rem; color: #94a3b8; display: flex; align-items: center; gap: 5px;">
                    Steps Today 
                    <a href="{{ url_for('logout_fit') }}" style="color: #ef4444; text-decoration: none; border: 1px solid #ef4444; padding: 2px 6px; border-radius: 4px; font-size: 0.7rem;">Disconnect</a>
                </div>
            </div>
        {% else %}
            <a href="{{ url_for('login_google') }}" style="display: flex; align-items: center; gap: 8px; text-decoration: none; color: #4ade80; background: rgba(74, 222, 128, 0.1); padding: 8px 12px; border-radius: 8px; border: 1px solid #4ade80; transition: 0.2s;">
                <span>üîó</span> 
                <span style="font-weight: bold;">Sync Google Fit</span>
            </a>
            <div class="stat-value" style="margin-top: 8px; font-size: 0.85rem; color: #64748b;">Tap to Connect</div>
        {% endif %}
    </div>
    
    <div class="stat-card">
        <div class="ring orange"><div class="ring-text">{{ user.calories }}</div></div>
        <div class="stat-value">Calories Burned</div>
    </div>
</div>

<div class="ai-insight">
    <div class="ai-avatar">AI</div>
    <div class="ai-text">
        <strong>LifeOS Coach</strong><br>
        Welcome back! The AI is ready to judge your tasks. Add a new quest below.
    </div>
</div>

<div class="card" style="margin-top: 1.5rem;">
    <h3>‚ûï Add New Quest</h3>
    <form action="{{ url_for('add_task') }}" method="POST" style="display: flex; gap: 10px; margin-top: 1rem;">
        <input type="text" name="task_name" placeholder="E.g., Read 10 pages of OS..." required style="flex: 1; padding: 10px; border-radius: 8px; border: 1px solid #334155; background: #1e293b; color: white;">
        
        <select name="category" style="padding: 10px; border-radius: 8px; border: 1px solid #334155; background: #1e293b; color: white;">
            <option value="Academic">Academic</option>
            <option value="Fitness">Fitness</option>
            <option value="Chore">Chore</option>
            <option value="Work">Work</option>
        </select>
        
        <button type="submit" class="verify-btn">Let AI Judge</button>
    </form>
</div>

<div class="card" style="margin-top: 2rem;">
    <h3>Active Quests</h3>
    
    {% for task in tasks %}
    <div class="task-item">
        <div class="task-info">
            <h4>{{ task.title }}</h4>
            <p>{{ task.category }} ‚Ä¢ <span style="color: #4ade80;">+{{ task.xp }} XP</span></p>
        </div>
        
        <div class="task-actions">
            {% if task.status == 'Pending' %}
                <a href="{{ url_for('complete_task', task_id=task.id) }}" class="verify-btn">Complete</a>
            {% else %}
                <span class="status-done">Done ‚úì</span>
            {% endif %}

            <a href="{{ url_for('delete_task', task_id=task.id) }}" class="delete-btn" title="Delete Task">üóëÔ∏è</a>
        </div>
    </div>
    {% endfor %}

</div>

{% endblock %}