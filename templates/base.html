<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LifeOS</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>

    <div class="sidebar">
        <div class="logo-area">LifeOS ğŸ§¬</div>
        
        <a href="{{ url_for('dashboard') }}" class="nav-item {% if page == 'dashboard' %}active{% endif %}">
            <div class="nav-icon">ğŸ </div> <span>Dashboard</span>
        </a>
        
        <a href="{{ url_for('tasks') }}" class="nav-item {% if page == 'tasks' %}active{% endif %}">
            <div class="nav-icon">âœ…</div> <span>Task Manager</span>
        </a>
        
        <a href="{{ url_for('fitness') }}" class="nav-item {% if page == 'fitness' %}active{% endif %}">
            <div class="nav-icon">ğŸ’ª</div> <span>Fitness Log</span>
        </a>
        
        <a href="{{ url_for('social') }}" class="nav-item {% if page == 'social' %}active{% endif %}">
            <div class="nav-icon">ğŸ†</div> <span>Social Hub</span>
        </a>
    </div>

    <div class="main-content">
        

        {% block content %}{% endblock %}
    </div>
<div id="lifey-icon" onclick="toggleChat()">
    ğŸ¤–
</div>

<div id="lifey-chat-window">
    <div class="chat-header">
        <span>Chat with Lifey</span>
        <span onclick="toggleChat()" style="cursor: pointer;">âœ–</span>
    </div>
    <div id="chat-content" class="chat-content">
        <div class="ai-msg">Hi Shreyas! I'm Lifey. How can I help you crush your goals today? ğŸš€</div>
    </div>
    <div class="chat-input-area">
        <input type="text" id="user-input" placeholder="Ask about tasks or fitness..." onkeypress="handleEnter(event)">
        <button onclick="sendMessage()">â¤</button>
    </div>
</div>

<script>
    function toggleChat() {
        var chat = document.getElementById("lifey-chat-window");
        chat.style.display = chat.style.display === "none" || chat.style.display === "" ? "flex" : "none";
    }

    function handleEnter(e) {
        if (e.key === 'Enter') sendMessage();
    }

    async function sendMessage() {
        var input = document.getElementById("user-input");
        var content = document.getElementById("chat-content");
        var text = input.value;
        if (!text) return;

        // User Message
        content.innerHTML += `<div class="user-msg">${text}</div>`;
        input.value = "";
        content.scrollTop = content.scrollHeight;

        // Send to Backend
        try {
            const response = await fetch('/ask_lifey', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: text })
            });
            const data = await response.json();
            
            // AI Reply
            content.innerHTML += `<div class="ai-msg">${data.reply}</div>`;
            content.scrollTop = content.scrollHeight;
        } catch (error) {
            content.innerHTML += `<div class="ai-msg">Error contacting Lifey :(</div>`;
        }
    }
</script>

</body>
</html>